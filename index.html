<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>A-frame</title>
  <script src="https://aframe.io/releases/1.4.0/aframe.js"></script>

</head>

<script>

  AFRAME.registerComponent('thumbstick-logging', {
    init: function () {
      this.el.addEventListener('thumbstickmoved', this.logThumbstick);
    },
    logThumbstick: function (evt) {
      let text = document.querySelector('#text_sign');
      if (evt.detail.y > 0.95) { text.setAttribute('value', 'DOWN'); }
      if (evt.detail.y < -0.95) { text.setAttribute('value', 'UP'); }
      if (evt.detail.x < -0.95) { text.setAttribute('value', 'LEFT'); }
      if (evt.detail.x > 0.95) { text.setAttribute('value', 'RIGHT'); }
    }
  });

  AFRAME.registerComponent('button-logging', {
    init: function () {
      this.el.addEventListener('triggerdown', this.logButton);
      this.el.addEventListener('gripdown', this.logButton);
    },
    logButton: function (evt) {
      let text = document.querySelector('#text_sign');
      text.setAttribute('value', evt);
    }
  });

</script>

<body>
  <a-scene renderer="antialias: true" stats>

    <a-asset>
      <img id="sky" src="./assets/sky/sky1.jpg">
      <img id="floorTexture" src="./assets/tx_2.jpg">
      <img id="ceilingTexture" src="./assets/tx_9.jpg">
      <img id="wallTexture" src="./assets/tx_5.jpg">
    </a-asset>

    <a-sky color="black"></a-sky>

    <a-plane id="floor" width="10" height="10" src="#floorTexture" position="0 0 -4" repeat="4 4"
      rotation="-90 0 0"></a-plane>
    <a-entity id="walls">
      <a-plane id="wall_right" width="10" height="2.5" src="#wallTexture" repeat="8 1" position="-5 1.25 -4"
        rotation="0 90 0"></a-plane>
      <a-plane id="wall_left" width="10" height="2.5" src="#wallTexture" repeat="8 1" position="5 1.25 -4"
        rotation="0 -90 0"></a-plane>
      <a-plane id="wall_back" width="10" height="2.5" src="#wallTexture" repeat="8 1" position="0 1.25 1"
        rotation="-180 0 0"></a-plane>
      <a-plane id="wall_front" width="10" height="2.5" src="#wallTexture" repeat="8 1" position="0 1.25 -9"></a-plane>
    </a-entity>
    <a-plane id="roof" width="10" height="10" src="#ceilingTexture" position="0 2.5 -4" repeat="4 4"
      rotation="90 0 0"></a-plane>

    <a-text id="text_sign" value="Hello World !!!" align="center" geometry="primitive:plane; width:5%; height:2"
      material="color:black" position="0 1.5 -5" color="white" rotation="0 0 0"></a-text>

    <a-entity class="questControl" button-logging thumbstick-logging oculus-touch-controls="hand: left"
      laser-controls="hand:left"></a-entity>
    <a-entity class="questControl" button-logging thumbstick-logging oculus-touch-controls="hand: right"
      laser-controls="hand:right"></a-entity>


    <a-camera>
      <a-cursor id="cursor" raycaster="objects: [data-raycastable]"></a-cursor>
    </a-camera>

  </a-scene>
  <script>
    // the controller
    let controller = document.querySelector('.questControl');

    const constraints = {
      'video': true,
      'audio': true
    }
    navigator.mediaDevices.getUserMedia(constraints)
      .then(stream => {
        console.log('Got MediaStream:', stream);
      })
      .catch(error => {
        console.error('Error accessing media devices.', error);
      });

    controller.addEventListener('triggerdown', function () {
      text.setAttribute('value', 'Trigger down pressed');
    })

    controller.addEventListener('gripdown', function () {
      text.setAttribute('value', 'Grip down pressed');
    })


  </script>
</body>

</html>